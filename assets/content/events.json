// ANGEBOTE aus CMS: /assets/content/offers.json
let offersData = null;
try { offersData = await loadJSON("/assets/content/offers.json"); }
catch (e) { console.warn("offers.json fehlt oder nicht erreichbar:", e); }

(function applyOffers(data){
  const o = data?.offers;
  if (!o) return;

  // Camps
  if (o.camps){
    setText("offersCampsText", o.camps.text);
    // Subcards Camps
    // 1) Ferien
    if (o.camps.sub && o.camps.sub[0]) setText("offersFerienText", o.camps.sub[0].text);
    // 2) Elite
    if (o.camps.sub && o.camps.sub[1]) setText("offersEliteText", o.camps.sub[1].text);

    // Button
    if (o.camps.button_label) setText("btnCamps", o.camps.button_label);
    if (o.camps.button_link) setHref("btnCamps", o.camps.button_link);
  }

  // Kurse
  if (o.kurse){
    setText("offersKurseText", o.kurse.text);
    setText("offersEliteKurseText", o.kurse.elite_box_text);

    // Pills (12/13 ...): map auf bestehende IDs p1213 etc.
    const pills = Array.isArray(o.kurse.power_pills) ? o.kurse.power_pills : [];
    const pillIds = ["p1213","p1415","p1617","p1819"];
    pillIds.forEach((id, i) => {
      if (pills[i]) setText(id, pills[i]);
    });

    // Buttons: wir nutzen vorhandene btnPower1819 / btnPower1617
    const btns = Array.isArray(o.kurse.buttons) ? o.kurse.buttons : [];
    // Erwartung: 0 = 18/19, 1 = 16/17
    if (btns[0]){
      if (btns[0].label) setText("btnPower1819", btns[0].label);
      if (btns[0].link) setHref("btnPower1819", btns[0].link);
    }
    if (btns[1]){
      if (btns[1].label) setText("btnPower1617", btns[1].label);
      if (btns[1].link) setHref("btnPower1617", btns[1].link);
    }
  }

  // Ballschule
  if (o.ballschule){
    setText("offersBallsText", o.ballschule.text);
  }

  // Fußballkindergarten
  if (o.kiga){
    setText("offersKigaText", o.kiga.text);
  }

  // Beratung (Text + Subcards + Links)
  if (o.beratung){
    setText("offersBeratungText", o.beratung.text);

    // Beratung-Subcards: in deinem HTML stehen aktuell feste Subcards ohne IDs.
    // Lösung: wir rendern sie komplett neu, aber nur innerhalb des Beratung-Blocks.
    const beratungDetails = Array.from(document.querySelectorAll("details.offerAcc"))
      .find(d => (d.querySelector(".offerAccTitle")?.textContent || "").trim().toLowerCase() === "beratung");

    if (beratungDetails){
      const container = beratungDetails.querySelector(".offerAccBody .subOffers");
      if (container){
        container.innerHTML = "";
        const subs = Array.isArray(o.beratung.sub) ? o.beratung.sub : [];
        subs.slice(0, 5).forEach((s) => {
          const div = document.createElement("div");
          div.className = "subCard";

          const title = s?.title || "";
          const text = s?.text || "";
          const link = s?.link || "";

          const titleHtml = link
            ? `<a href="${link}" target="_blank" rel="noreferrer"><b>${title}</b></a>`
            : `<b>${title}</b>`;

          div.innerHTML = `
            ${titleHtml}
            <small>${text ? text : ""}</small>
          `;

          container.appendChild(div);
        });
      }
    }
  }
})(offersData);


// EVENTS aus CMS: /assets/content/events.json
let eventsData = null;
try { eventsData = await loadJSON("/assets/content/events.json"); }
catch (e) { console.warn("events.json fehlt oder nicht erreichbar:", e); }

(function applyEvents(data){
  if (!data) return;

  // Titel im Accordion-Summary
  if (data.title) setText("eventsTitle", data.title);

  const grid = document.getElementById("eventsGrid");
  const items = Array.isArray(data.items) ? data.items : [];
  if (!grid || !items.length) return;

  grid.innerHTML = "";
  items.slice(0, 6).forEach((ev) => {
    const card = document.createElement("div");
    card.className = "card";

    const title = ev?.title || "";
    const date = ev?.date || "";
    const text = ev?.text || "";
    const link = ev?.link || "";
    const linkLabel = ev?.link_label || "Mehr erfahren";
    const img = ev?.image || "";

    const dateHtml = date ? `<p style="margin:0 0 8px;color:rgba(11,16,32,.55);font-weight:900;letter-spacing:.18em;text-transform:uppercase;font-size:11px;">${date}</p>` : "";
    const imgHtml = img ? `<img src="${img}" alt="${title}" style="width:100%;height:140px;object-fit:cover;border:1px solid var(--card-border);margin-bottom:10px;display:block;">` : "";
    const linkHtml = link ? `<div class="cardActions" style="margin-top:12px;"><a class="btn btnGhost" href="${link}" target="_blank" rel="noreferrer">${linkLabel}</a></div>` : "";

    card.innerHTML = `
      ${imgHtml}
      ${dateHtml}
      <h3>${(title || "").toUpperCase()}</h3>
      <p>${text}</p>
      ${linkHtml}
    `;
    grid.appendChild(card);
  });
})(eventsData);
